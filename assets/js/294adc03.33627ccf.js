"use strict";(self.webpackChunksmart_van_2_0_github_io=self.webpackChunksmart_van_2_0_github_io||[]).push([[3565],{9511:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>g,frontMatter:()=>o,metadata:()=>d,software_category:()=>p,software_code:()=>m,software_language:()=>j,software_name:()=>c,software_status:()=>h,software_version:()=>u,toc:()=>x});var t=s(4848),i=s(8453),r=s(2349);const o={title:"Contribute to JOD SV Dist.",hide_title:!0,sidebar_position:6},a=void 0,d={id:"software/jod_smart_van/jod_smart_van/guides/contribute_jod_sv_dist",title:"Contribute to JOD SV Dist.",description:"\x3c!--",source:"@site/docs/software/jod_smart_van/jod_smart_van/guides/contribute_jod_sv_dist.mdx",sourceDirName:"software/jod_smart_van/jod_smart_van/guides",slug:"/software/jod_smart_van/jod_smart_van/guides/contribute_jod_sv_dist",permalink:"/docs/software/jod_smart_van/jod_smart_van/guides/contribute_jod_sv_dist",draft:!1,unlisted:!1,editUrl:"https://github.com/smart-van-2-0/smart-van-2-0.github.io/edit/main/docs/software/jod_smart_van/jod_smart_van/guides/contribute_jod_sv_dist.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Contribute to JOD SV Dist.",hide_title:!0,sidebar_position:6},sidebar:"docsSidebar",previous:{title:"Connect to remote SVBox",permalink:"/docs/software/jod_smart_van/jod_smart_van/guides/connect_remote_svbox"},next:{title:"JOD Smart Van Image",permalink:"/docs/software/jod_smart_van/jod_smart_van_image/"}},l={},c="JOD Smart Van",h="Development",m="jod_smart_van",u="1.0.0",p="Object Agent",j="JOD Distribution",x=[{value:"Contribute to JOD SmartVan Distribution",id:"contribute-to-jod-smartvan-distribution",level:2},{value:"Project structure",id:"project-structure",level:2},{value:"Build JOD Smart Van distribution",id:"build-jod-smart-van-distribution",level:2},{value:"Deploy on remote machine",id:"deploy-on-remote-machine",level:2},{value:"Configure SSH keys to avoid password usage",id:"configure-ssh-keys-to-avoid-password-usage",level:3},{value:"Run on development machine",id:"run-on-development-machine",level:2},{value:"Update a Smart Van Specs/JOD Pillars",id:"update-a-smart-van-specsjod-pillars",level:2},{value:"Add a new firmware",id:"add-a-new-firmware",level:2}];function f(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Uo,{name:c,status:h}),"\n",(0,t.jsx)(n.h2,{id:"contribute-to-jod-smartvan-distribution",children:"Contribute to JOD SmartVan Distribution"}),"\n",(0,t.jsx)(n.h2,{id:"project-structure",children:"Project structure"}),"\n",(0,t.jsxs)(n.p,{children:["The JOD Smart Van project is a JOD distribution. It is based on the\n",(0,t.jsx)(n.a,{href:"https://docs.johnosproject.org/references/tools/jod_dist_template/",children:"JOD Dist TMPL"}),"\nproject and inherits its structure. The JOD Smart Van project is organized with\nthe following directory and files:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"configs/jod_dist_configs[-DEV].(sh|ps1)"}),":",(0,t.jsx)("br",{}),"\nMain distribution configuration file. It contains all the variables used by\nthe JOD Dist TMPL scripts to build the distribution. It also contains the\nfirmware list to include into the distribution."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/configs/jod_configs[-DEV].(sh|ps1)"}),":",(0,t.jsx)("br",{}),"\nJOD execution's configuration file. It contains all the shell's variables set\nbefore executing any JOD's script (like start.sh etc...)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/configs/struct.jod"}),":",(0,t.jsx)("br",{}),"\nJOD structure file. It contains the JOD Smart Van structure, i.e., the\nendpoints exposed by the JOD Smart Van agent (aka John's Pillars/Smart Van\nSpecifications)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/configs/jod_TMPL.yml"}),":",(0,t.jsx)("br",{}),"\nJOD configuration file. It contains all the variables used by the JOD daemon\nto run the JOD Smart Van agent."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/configs/log4j2_TMPL*.xml"}),":",(0,t.jsx)("br",{}),"\nLog4j2 configuration file. It contains the configuration for the JOD Smart Van\nagent's logger. Depending on the JOD version's used, there are two different\nfiles: one for JOD 2.2.3 and one for JOD 2.2.4."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/resources/README.md"})," & Co:",(0,t.jsx)("br",{}),"\nDistribution's README.md file and other documentation."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/resources/configs/struct_*.jod"}),":",(0,t.jsx)("br",{}),"\nAlternative JOD structure files. They are used to test the JOD Smart Van\ndistribution with different JOD structures. They can be used also as examples\nto Pillars customization."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/resources/scripts/pre-startup.sh"}),":",(0,t.jsx)("br",{}),"\nScripts executed before the JOD Smart Van agent startup. This script  starts\nthe firmwares and the JOD Smart Van agent."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/resources/scripts/post-shutdown.sh"}),":",(0,t.jsx)("br",{}),"\nScripts executed after the JOD Smart Van agent shutdown. This script stops the\nfirmwares."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dists/scripts"}),":    FROM JOD Dist TMPL",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.em,{children:"Scripts and utils from the JOD Dist TMPL project."})," Those scripts are copied\ninto the distribution and used to run, stop and install the JOD Smart Van\ndistribution."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"docs"}),":",(0,t.jsx)("br",{}),"\nJOD Smart Van project documentation files."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scripts"}),":    FROM JOD Dist TMPL",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.em,{children:"Scripts and utils from the JOD Dist TMPL project."})," Those scripts are used to\nbuild, install and publish the JOD Smart Van distribution."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"build-jod-smart-van-distribution",children:"Build JOD Smart Van distribution"}),"\n",(0,t.jsxs)(n.p,{children:["Starting from the JOD Smart Van project, you can generate a JOD Smart Van\ndistribution using the ",(0,t.jsx)(n.code,{children:"scripts/build.sh"})," command. This command handles the\ndownload of the JOD daemon, all its dependencies, and the configured firmwares.\nAfterward, it combines all files (downloaded, configuration, and scripts) into\nthe folder that constitutes the JOD distribution."]}),"\n",(0,t.jsxs)(n.p,{children:["This workflow is made possible by\nthe ",(0,t.jsx)(n.a,{href:"https://docs.johnosproject.org/references/tools/jod_dist_template/",children:"JOD Dist TMPL project"}),",\nthe foundation of this very project."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Standard command\nbash scripts/build.sh\n\n# Build development version\nbash scripts/build.sh configs/jod_dist_configs-DEV.sh\n\n# Build with debug logs\nDEBUG=true bash scripts/build.sh\n"})}),"\n",(0,t.jsx)(n.p,{children:"There are two configurations for building a JOD Smart Van distribution:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Production: ",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs.sh|ps1"})]}),"\n",(0,t.jsxs)(n.li,{children:["Development: ",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs-DEV.sh|ps1"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The two configurations differ not only in their settings but also in where they\nretrieve the firmwares. In the case of a production build, the firmwares are\ndownloaded from their git repositories as compressed files. In the case of a\ndevelopment build, the firmwares are searched locally, in the same folder as\nthe JOD Smart Van project."}),"\n",(0,t.jsxs)(n.p,{children:["It is recommended to use the production distribution when deploying it on a\n",(0,t.jsx)(n.a,{href:"https://www.smartvanbox.org/docs/hardware",children:"Smart Van Box"})," (aka\nRaspberry Pi). If you want to test the distribution or simulate a Smart Van Box,\nthen the development build is recommended."]}),"\n",(0,t.jsxs)(n.p,{children:["Once you have the folder containing the distribution, you\ncan ",(0,t.jsx)(n.a,{href:"#run-on-development-machine",children:"run it locally"}),"\nor ",(0,t.jsx)(n.a,{href:"#deploy-on-remote-machine",children:"deploy it"})," on an embedded device (aka Raspberry\nPi)."]}),"\n",(0,t.jsx)(n.admonition,{title:"JOD 2.2.4 Required",type:"warning",children:(0,t.jsx)(n.p,{children:"This distribution requires some features available only on the 2.2.4\nversion of the JOD Distribution. Actually there is at least the 2.2.3 JOD\nversion as public available. So, in order to build this distribution, you'll\nneed to download the JOD source code and publish it locally (with the 2.2.4-DEV\nversion). Then the JOD Smart Van distribution's build script will be able to\ninclude the 2.2.4-DEV JOD version from your local repository."})}),"\n",(0,t.jsx)(n.h2,{id:"deploy-on-remote-machine",children:"Deploy on remote machine"}),"\n",(0,t.jsx)(n.p,{children:"Once the JOD Smart Van distribution is built, you can copy it to an embedded\ndevice (aka Raspberry Pi) and start it."}),"\n",(0,t.jsx)(n.p,{children:"To do this, you need an SSH connection to the embedded device. This will be used\nto copy the distribution files and to start the distribution itself."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Connect and create dir into remote machine (only once)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ssh pi@raspberrypi.local\n(rpi)$ mkdir -p dev/jod_smart_van\n(rpi)$ exit\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Copy local sources to remote machine (to upload every updates on distribution)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ rsync -av --exclude venv --exclude logs --exclude __pycache__ --exclude .git --exclude 'build*' -e ssh * pi@raspberrypi.local:/home/pi/dev/jod_smart_van\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Connect to remote machine and cd to JOD Smart Van distribution dir"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ssh pi@raspberrypi.local\n(rpi)$ cd dev/jod_smart_van\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"Install requirements (only once)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ sudo apt update\n(rpi)$ sudo apt install default-jdk\n(rpi)$ sudo apt-get install python3 libcairo2-dev libgirepository1.0-dev dbus-x11\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsx)(n.li,{children:"Install firmware's requirements (only once)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ cd dev/jod_smart_van/{FW_DIR}\n(rpi)$ python -m venv venv           # Optional: only for venv support\n(rpi)$ source venv/bin/activate      # Optional: only for venv support\n(rpi-venv)$ pip install -r requirements.txt\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"6",children:["\n",(0,t.jsx)(n.li,{children:"Init DBus session (only if required)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ env | grep DBUS_SESSION_BUS_ADDRESS\n# no response means the DBus session is required\n(rpi)$ exec dbus-run-session -- bash\n(rpi)$ env | grep DBUS_SESSION_BUS_ADDRESS\n# copy the printed output as DBUS Session\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"7",children:["\n",(0,t.jsx)(n.li,{children:"Startup the JOD Smart Van distribution"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ bash start.sh\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"8",children:["\n",(0,t.jsx)(n.li,{children:"Check the JOD Smart Van distribution status or print logs"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ bash status.sh\n(rpi)$ tail -f logs/jospJOD.log\n(rpi)$ tail -f logs/fw_{code}_{timestamp}.log\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"9",children:["\n",(0,t.jsx)(n.li,{children:"Shutdown the JOD Smart Van distribution"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"(rpi)$ bash stop.sh\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"DBus system",type:"warning",children:(0,t.jsx)(n.p,{children:"If the remote machine does not have any graphical server installed, the DBUS\ndaemon is likely not running, and thus, it needs to be started manually."})}),"\n",(0,t.jsx)(n.h3,{id:"configure-ssh-keys-to-avoid-password-usage",children:"Configure SSH keys to avoid password usage"}),"\n",(0,t.jsx)(n.p,{children:"Procedure to configure SSH keys to avoid password usage when connecting to a\nremote machine. The examples below are for a Raspberry Pi, but the procedure is\nthe same for any other machine, remembering to replace the username and hostname\nwith the correct ones."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Create a 'public_keys' on the remote machine"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ssh pi@raspberrypi.local\n(rpi)$ mkdir -p .ssh/public_keys\n(rpi)$ exit\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Generate a new key pair and copy the public one on the remote machine"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ssh-keygen -t rsa\n#  save it in /home/USER/.ssh/id_rsa_for_rpi\n$ scp /home/USER/.ssh/id_rsa_for_rpi.pub pi@raspberrypi.local:/home/pi/.ssh/public_keys\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"Set up the new public key into remote machine"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ ssh pi@raspberrypi.local\n(rpi)$ cat .ssh/pub_keys/id_rsa_for_rpi.pub >> .ssh/authorized_keys\n"})}),"\n",(0,t.jsx)(n.p,{children:"Those steps are required only once.\n..."}),"\n",(0,t.jsx)(n.h2,{id:"run-on-development-machine",children:"Run on development machine"}),"\n",(0,t.jsxs)(n.p,{children:["When building the JOD Smart Van distribution using the development\nconfigurations ",(0,t.jsx)(n.code,{children:"jod_dist_configs-DEV.sh"}),", a distribution ready for execution on\nthe development machine is generated. For example, options like ",(0,t.jsx)(n.code,{children:"SIMULATE"})," and\n",(0,t.jsx)(n.code,{children:"VENV"})," are enabled, allowing the simulation of underlying hardware and testing\nthe distribution without physically connecting all sensors and actuators."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Clone repositories:"}),"\nClone the JOD Smart Van project repository and those of its related firmwares\nwithin the same folder. For a complete list of available firmwares, visit the\n",(0,t.jsx)(n.a,{href:"https://github.com/search?q=topic%3Afirmware+org%3ASmart-Van-2-0&type=Repositories",children:"Smart Van 2.0 Firmware"}),"\npage."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"mkdir jod_sv_dev\ncd jod_sv_dev\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.jod_smart_van.git\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.fw.victron.git\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.fw.sim7600.git\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.fw.upspack_v3.git\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.fw.sensehat.git\ngit clone git@github.com:Smart-Van-2-0/com.robypomper.smartvan.fw.ioexp.git\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Build JOD Smart Van distribution:"}),"\nGenerate the JOD Smart Van distribution using the development configurations.\nThis will copy the firmwares from local folders. For more information, refer\nto the Build JOD Smart Van distribution section."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cd com.robypomper.smartvan.jod_smart_van.git\nbash scripts/build.sh configs/jod_dist_configs-DEV.sh\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Run on the local machine:"}),"\nStart JOD Smart Van; along with the JOD daemon, the enabled firmwares will\nalso be launched. Refer to the run and installation sections for more\ninformation."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cd build/JOD_Smart_Van/{VERSION}\nbash start.sh true\n>> type 'exit' to stop the JOD Smart Van instance\n"})}),"\n",(0,t.jsx)(n.p,{children:"Additionally, with the development configurations, the firmwares are no longer\ndownloaded from a URL but copied from local folders. This allows for modifying\nthe firmwares during development and testing the changes without having to\npublish modifications each time."}),"\n",(0,t.jsx)(n.p,{children:"These configurations assume that the firmware repositories are cloned into the\nsame folder as the JOD Smart Van project, resulting in the following folder\nstructure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"jod_sv_dev\n\u251c\u2500\u2500 com.robypomper.smartvan.jod_smart_van\n\u251c\u2500\u2500 com.robypomper.smartvan.fw_victron\n\u251c\u2500\u2500 com.robypomper.smartvan.fw_sim7600\n\u251c\u2500\u2500 com.robypomper.smartvan.fw_upspack_v3\n\u251c\u2500\u2500 com.robypomper.smartvan.fw_sensehat\n\u251c\u2500\u2500 com.robypomper.smartvan.fw_ioexp\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you keep the ",(0,t.jsx)(n.code,{children:"VENV"})," option enabled, remember to create a virtual environment\nfor each included firmware. For example, go to the directory where you cloned\nthe firmware and run the following command. The created folder will be included\nin the distribution the next time you run the ",(0,t.jsx)(n.code,{children:"scripts/build.sh"})," command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cd ../com.robypomper.smartvan.{FW_CODE}\npython3 -m venv venv\n"})}),"\n",(0,t.jsx)(n.h2,{id:"update-a-smart-van-specsjod-pillars",children:"Update a Smart Van Specs/JOD Pillars"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"struct.jod"})," file contains ",(0,t.jsx)(n.strong,{children:"the list of Smart Van specifications"})," to be\nexposed to the mobile app. You can modify this file to add new specifications or\nupdate existing ones (Note: In the John OS Platform, these specifications are\ncalled ",(0,t.jsx)(n.a,{href:"https://docs.johnosproject.org/references/josp/jod/specs/pillars/",children:"Pillars"}),",\nand they can be of two types: States or Actions)."]}),"\n",(0,t.jsxs)(n.p,{children:["Each Pillar within the ",(0,t.jsx)(n.code,{children:"struct.jod"})," file, in addition to having a name and path\ndefined by Smart Van specifications, also ",(0,t.jsx)(n.strong,{children:"defines how to interact with the\ncorresponding hardware"}),". The JOD daemon provides various methods to interact\nwith the hardware, including reading/writing to files, executing shell commands,\nmaking HTTP requests, connecting to DBUS, and many more."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"JOD Smart Van primarily uses DBUS to communicate with various firmware managing\nsensors and actuators in the box."})}),"\n",(0,t.jsxs)(n.p,{children:['For example, the specification "Energy > Battery > Percentage" corresponds to a\nPillar in the ',(0,t.jsx)(n.code,{children:"struct.jod"})," file with the same path and name. As this is a\nspecification for a value (0-100) provided by the Smart Van Box, it corresponds\nto a RangeState pillar:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "model": "JOD Smart Van",\n  "Percentage": {\n    "type": "RangeState",\n    "desc": "Battery charge percentage",\n    "listener": "dbus://dbus_name=com.victron;dbus_obj_path=/smartsolar_mppt;dbus_iface=com.victron.SmartSolarMPPT;dbus_prop=battery_voltage_percent;init_data=0;",\n    "min": "0",\n    "max": "100000",\n    "step": "1"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["From other properties of the pillar, it can be observed that the associated\nfirmware exposes the property ",(0,t.jsx)(n.code,{children:"battery_voltage_percent"})," on the DBUS\n",(0,t.jsx)(n.code,{children:"com.victron"})," with the object path ",(0,t.jsx)(n.code,{children:"/smartsolar_mppt"})," and the interface\n",(0,t.jsx)(n.code,{children:"com.victron.SmartSolarMPPT"}),". Those values must be edited according to the\nfirmware that should be used to manage the underlying hardware."]}),"\n",(0,t.jsxs)(n.p,{children:["You can find more examples\nof ",(0,t.jsxs)(n.a,{href:"customize_svbox_structure#alternative-jod-structures",children:["alternative ",(0,t.jsx)(n.code,{children:"struct.jod"})," files"]})," in the\n",(0,t.jsx)(n.code,{children:"dists/resources/configs"})," folder; or, directly, into a JOD Smart Van\ndistribution's ",(0,t.jsx)(n.code,{children:"configs"})," dir."]}),"\n",(0,t.jsx)(n.h2,{id:"add-a-new-firmware",children:"Add a new firmware"}),"\n",(0,t.jsxs)(n.p,{children:["To add a new firmware to the JOD Smart Van distribution, simply include the\nfirmware as a dependency in the ",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs*"})," files and the two\ndistribution scripts ",(0,t.jsx)(n.code,{children:"pre-startup.sh"})," and ",(0,t.jsx)(n.code,{children:"post-shutdown.sh"}),"."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Add the firmware as a dependency:"}),"\nFor each firmware to be included, add the corresponding string to the\n",(0,t.jsx)(n.code,{children:"JOD_DIST_DEPS"})," variable in the ",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs*"})," files. Firmwares\ncan\nbe included as links or local folders. In the former case, specify the link\nto the firmware and the destination folder ",(0,t.jsx)(n.code,{children:"{URL}@{DEST_DIR}"}),", while in the\nlatter case, specify only the local folder to copy."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'JOD_DIST_DEPS=(\n...\n"{URL}@{DEST_DIR}"\n)\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["In the ",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs.sh|ps1"})," files, links to published firmwares are\ntypically added, while in the development configuration file (\n",(0,t.jsx)(n.code,{children:"configs/jod_dist_configs-DEV.sh|ps1"}),"), the local folder containing the firmware\nis added."]})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configure firmware startup/shutdown:"}),"\nFor each firmware to be included, configure the\n",(0,t.jsx)(n.code,{children:"dists/resources/scripts/pre-startup.sh"})," file to start the firmware before the JOD\ndaemon starts, and the ",(0,t.jsx)(n.code,{children:"dists/resources/scripts/post-shutdown.sh"})," file to\nterminate the firmware after the JOD daemon termination."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# Launch firmwares <= dists/resources/scripts/pre-startup.sh\nlaunch_fw "com.robypomper.smartvan.fw.victron" "" $simulate $venv $inline_logs\n\n# Kill firmwares <= dists/resources/scripts/post-shutdown.sh\nstop_fw "com.robypomper.smartvan.fw.victron"\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"For each firmware, specify the firmware code, the firmware name, and the\nstartup options. For more information, refer to the JOD Dist TMPL\ndocumentation."})}),"\n",(0,t.jsxs)(n.p,{children:["When the new firmware is added, you can update the ",(0,t.jsx)(n.code,{children:"struct.jod"})," file to include\nthe new specifications provided by the firmware. For more information, refer to\nthe ",(0,t.jsx)(n.a,{href:"#update-a-smart-van-specsjod-pillars",children:"Update a Smart Van Specs"})," section."]})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(f,{...e})}):f(e)}},9683:(e,n,s)=>{s.d(n,{A:()=>r});s(6540);const t={img_container:"img_container_ABGT",img_link:"img_link_Hl3U",img_tag:"img_tag_oucX"};var i=s(4848);function r(e){return(0,i.jsx)("div",{className:t.img_container,children:(0,i.jsx)("a",{href:e.link?e.link:e.src,className:t.img_link,children:(0,i.jsx)("img",{src:e.src,alt:e.alt,width:e.width?e.width:"100%",className:t.img_tag})})})}},7109:(e,n,s)=>{s.d(n,{A:()=>r});s(6540);const t={container:"container_mzDT",h1:"h1_n6cG"};var i=s(4848);function r(e){return(0,i.jsx)("div",{className:t.container,children:(0,i.jsxs)("h1",{className:t.h1,children:[e.section," - ",e.subsection]})})}},3161:(e,n,s)=>{s.d(n,{r0:()=>h,Wx:()=>r,A:()=>o,PD:()=>d,OM:()=>l,hB:()=>a,Ay:()=>m});s(6540);const t={web_site_map:"web_site_map_qmuZ"};var i=s(4848);function r(){return(0,i.jsx)("a",{href:"/docs",children:"DOCS"})}function o(){return(0,i.jsx)("a",{href:"/docs/features",children:"FEATURES"})}function a(){return(0,i.jsx)("a",{href:"/docs/specs",children:"SPECIFICATIONS"})}function d(){return(0,i.jsx)("a",{href:"/docs/hardware",children:"HARDWARE"})}function l(){return(0,i.jsx)("a",{href:"/docs/software",children:"SOFTWARE"})}function c(){return(0,i.jsx)("a",{href:"/about",children:"ABOUT"})}function h(){return(0,i.jsx)("a",{href:"/collaborate",children:"COLLABORATE"})}function m(){return(0,i.jsxs)("div",{className:t.web_site_map,children:[(0,i.jsx)(o,{}),"|",(0,i.jsx)(d,{}),"|",(0,i.jsx)(l,{}),"|",(0,i.jsx)(a,{}),"|",(0,i.jsx)(c,{}),"|",(0,i.jsx)(h,{})]})}},2349:(e,n,s)=>{s.d(n,{VG:()=>l,N8:()=>h,e0:()=>c,Uo:()=>d});s(6540);const t={tmpl_container:"tmpl_container_A9hk",specs_table:"specs_table_BWcA",head_container:"head_container_KR7S",descr:"descr_CuXp",lists_container:"lists_container_Qejd",logo:"logo_Y7bK",list:"list_tLdV",list_item:"list_item_WUvh"};var i=s(9683),r=s(7109),o=s(3161),a=s(4848);function d(e){return(0,a.jsx)(r.A,{section:"Software",subsection:e.name})}function l(e){return(0,a.jsxs)("div",{className:t.head_container,children:[(0,a.jsxs)("div",{className:t.lists_container,children:[e.url_logo?(0,a.jsxs)("div",{children:[(0,a.jsx)(i.A,{src:e.url_logo,width:"200px"}),(0,a.jsx)("hr",{})]}):null,(0,a.jsx)("h3",{children:"Status"}),(0,a.jsxs)("ul",{className:t.list,children:[(0,a.jsxs)("li",{className:t.list_item,children:[(0,a.jsx)("b",{children:"Status:"})," ",e.current_status]}),(0,a.jsxs)("li",{className:t.list_item,children:[(0,a.jsx)("b",{children:"Version:"})," ",e.current_version]}),(0,a.jsxs)("li",{className:t.list_item,children:[(0,a.jsx)("b",{children:"Category:"})," ",e.category]}),(0,a.jsxs)("li",{className:t.list_item,children:[(0,a.jsx)("b",{children:"Language:"})," ",e.language]}),(0,a.jsxs)("li",{className:t.list_item,children:[(0,a.jsx)("b",{children:"Code:"})," ",e.code]})]}),(0,a.jsx)("hr",{}),(0,a.jsx)("h3",{children:"Links"}),(0,a.jsxs)("ul",{className:t.list,children:[e.url_repo?(0,a.jsx)("li",{className:t.list_item,children:(0,a.jsx)("a",{href:e.url_repo+"",children:"Git Repo"})}):"",e.url_docs?(0,a.jsx)("li",{className:t.list_item,children:(0,a.jsx)("a",{href:e.url_docs+"",children:"Docs"})}):"",e.url_downloads?(0,a.jsx)("li",{className:t.list_item,children:(0,a.jsx)("a",{href:e.url_downloads+"",children:"Downloads"})}):"",e.url_support?(0,a.jsx)("li",{className:t.list_item,children:(0,a.jsx)("a",{href:e.url_support+"",children:"Support"})}):""]})]}),(0,a.jsx)("div",{className:t.descr,children:e.children})]})}function c(){return(0,a.jsxs)("p",{children:["The following table lists all Smart Van ",(0,a.jsx)(o.hB,{})," that can be provided by this firmware. Then, you can use this info to customize the `struct.jod` file of the ",(0,a.jsx)("a",{href:"/docs/software/jod_smart_van/jod_smart_van",children:"JOD Smart Van"})," distribution."]})}function h(e){return(0,a.jsxs)("table",{className:t.specs_table,children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Property Name"}),(0,a.jsx)("th",{children:"Specification"})]}),Object.keys(e.specs_provided).map(((n,s)=>{const t=e.specs_provided[n].fw_value,i=e.specs_provided[n].group,r=e.specs_provided[n].sub_group,o=e.specs_provided[n].spec;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("code",{children:t})}),(0,a.jsx)("td",{children:(0,a.jsxs)("a",{href:"/docs/specs/"+i+"/"+r+"#"+o,children:[i," > ",r," > ",o]})})]},s)}))]})}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);